# Brocade Stack OS Discovery - FastIron + ICX stackable switches
# Foundry enterprise OID only: .1.3.6.1.4.1.1991
# OIDs VERIFIED against FCX648 6-unit stack running IronWare 08.0.30uT7f1
# Testing date: 2026-02-04
#
# IMPORTANT: Power supply tables are mutually exclusive:
#   - snChasPwrSupply2Table: Stacked (unit.ps indexing)
#   - snChasPwrSupplyTable: Standalone (ps indexing only)
---
mib: FOUNDRY-SN-AGENT-MIB
modules:
  mempools:
    data:
      - total: FOUNDRY-SN-AGENT-MIB::snAgGblDynMemTotal
        free: FOUNDRY-SN-AGENT-MIB::snAgGblDynMemFree
        descr: 'System Memory'
  os:
    hardware_mib: FOUNDRY-SN-ROOT-MIB
    sysDescr_regex: '/(?:IronWare|FastIron) Version (?<version>[\d.]+[a-z\d]*)/'
    hardware_regex: '/(?:FCX|FWS|FLS|ICX)\d*[A-Z0-9-]*/i'
    serial: FOUNDRY-SN-AGENT-MIB::snChasSerNum.0
    version: FOUNDRY-SN-AGENT-MIB::snAgImgVer.0
  sensors:
    power:
      data:
        # Power Supply Table 2 - For stacked configurations ONLY
        # Index format: {unit}.{ps_number} (e.g., 1.1, 1.2, etc.)
        # Verified: 6 units Ã— 2 PS each = 12 total power supplies
        # Only used when "Stacking System" is in sysDescr
        - oid: FOUNDRY-SN-AGENT-MIB::snChasPwrSupply2Table
          value: FOUNDRY-SN-AGENT-MIB::snChasPwrSupply2OperStatus
          num_oid: '.1.3.6.1.4.1.1991.1.1.1.2.2.1.4.{{ $index }}'
          descr: 'Power Supply {{ $index }}'
          group: 'Power Supply'
          state_name: snChasPwrSupply2OperStatus
          skip_values:
            - oid: "SNMPv2-MIB::sysDescr.0"
              op: "!~"
              value: "Stacking System"
          states:
            - {value: 1, descr: other, graph: 0, generic: 3}
            - {value: 2, descr: normal, graph: 1, generic: 0}
            - {value: 3, descr: failure, graph: 0, generic: 2}
        # Power Supply Table 1 - For standalone configurations ONLY
        # Index format: {ps_number} (e.g., 1, 2)
        # Only used when NOT a stacking system (prevents duplication)
        - oid: FOUNDRY-SN-AGENT-MIB::snChasPwrSupplyTable
          value: FOUNDRY-SN-AGENT-MIB::snChasPwrSupplyOperStatus
          num_oid: '.1.3.6.1.4.1.1991.1.1.1.2.1.1.3.{{ $index }}'
          descr: 'Power Supply {{ $index }}'
          group: 'Power Supply'
          state_name: snChasPwrSupplyOperStatus
          skip_values:
            - oid: "SNMPv2-MIB::sysDescr.0"
              op: "=~"
              value: "Stacking System"
          states:
            - {value: 1, descr: other, graph: 0, generic: 3}
            - {value: 2, descr: normal, graph: 1, generic: 0}
            - {value: 3, descr: failure, graph: 0, generic: 2}
    state:
      data:
        # Stack Configuration State - DISABLED
        # This OID does NOT exist on firmware 08.0.30u
        # Commented out to prevent discovery errors
        # - oid: FOUNDRY-SN-SWITCH-GROUP-MIB::snStackingGlobalConfigState
        #   value: FOUNDRY-SN-SWITCH-GROUP-MIB::snStackingGlobalConfigState
        #   num_oid: '.1.3.6.1.4.1.1991.1.1.3.31.2.1.1.0'
        #   descr: 'Stack Configuration'
        #   group: 'Stack Status'
        #   state_name: snStackingGlobalConfigState
        #   states:
        #     - { value: 0, descr: disabled, graph: 0, generic: 3 }
        #     - { value: 1, descr: enabled, graph: 1, generic: 0 }
        #     - { value: 2, descr: unsupported, graph: 0, generic: 2 }

        # Stack Unit State - Verified working on 6-unit stack
        # Returns: 1=local (master), 2=remote (members)
        - oid: FOUNDRY-SN-STACKING-MIB::snStackingOperUnitTable
          value: FOUNDRY-SN-STACKING-MIB::snStackingOperUnitState
          num_oid: '.1.3.6.1.4.1.1991.1.1.3.31.2.2.1.5.{{ $index }}'
          descr: 'Unit {{ $index }} State'
          group: 'Stack Status'
          state_name: snStackingOperUnitState
          skip_values:
            - oid: "SNMPv2-MIB::sysDescr.0"
              op: "!~"
              value: "Stacking System"
          states:
            - {value: 1, descr: local, graph: 1, generic: 0}
            - {value: 2, descr: remote, graph: 1, generic: 0}
            - {value: 3, descr: reserved, graph: 0, generic: 2}
            - {value: 4, descr: empty, graph: 0, generic: 2}

        # Stack Unit Role - Verified working on 6-unit stack
        # Returns: 2=active (master), 3=standby, 4=member
        - oid: FOUNDRY-SN-STACKING-MIB::snStackingOperUnitTable
          value: FOUNDRY-SN-STACKING-MIB::snStackingOperUnitRole
          num_oid: '.1.3.6.1.4.1.1991.1.1.3.31.2.2.1.2.{{ $index }}'
          descr: 'Unit {{ $index }} Role'
          group: 'Stack Status'
          state_name: snStackingOperUnitRole
          skip_values:
            - oid: "SNMPv2-MIB::sysDescr.0"
              op: "!~"
              value: "Stacking System"
          states:
            - {value: 1, descr: other, graph: 0, generic: 3}
            - {value: 2, descr: active, graph: 1, generic: 0}
            - {value: 3, descr: standby, graph: 1, generic: 0}
            - {value: 4, descr: member, graph: 1, generic: 0}
            - {value: 5, descr: standalone, graph: 1, generic: 0}
