# Brocade Stack OS Discovery - FastIron + ICX stackable switches
# Foundry enterprise OID only: .1.3.6.1.4.1.1991
# OIDs VERIFIED against FCX648 6-unit stack running IronWare 08.0.30uT7f1
# Testing date: 2026-02-04
#
# IMPORTANT: Power supply tables are mutually exclusive:
#   - snChasPwrSupply2Table: Stacked (unit.ps indexing)
#   - snChasPwrSupplyTable: Standalone (ps indexing only)
---
mib: FOUNDRY-SN-AGENT-MIB
modules:
  mempools:
    data:
      - total: FOUNDRY-SN-AGENT-MIB::snAgSystemDRAMTotal
        free: FOUNDRY-SN-AGENT-MIB::snAgSystemDRAMFree
        descr: 'System Memory'
        type: ironware-system
  os:
    hardware_mib: FOUNDRY-SN-ROOT-MIB
    sysDescr_regex: '/(?:IronWare|FastIron) Version (?<version>[\d.]+[a-z\d]*)/'
    hardware_regex: '/(?:FCX|FWS|FLS|ICX)\d*[A-Z0-9-]*/i'
    serial: FOUNDRY-SN-AGENT-MIB::snChasSerNum.0
    version: FOUNDRY-SN-AGENT-MIB::snAgImgVer.0
  processors:
    data:
      # CPU utilization - 1 second average
      - oid: FOUNDRY-SN-AGENT-MIB::snAgGblCpuUtil1SecAvg
        value: FOUNDRY-SN-AGENT-MIB::snAgGblCpuUtil1SecAvg
        num_oid: '.1.3.6.1.4.1.1991.1.1.2.11.1.0'
        descr: 'CPU 1sec avg'
        index: 0
      # CPU utilization - 5 second average
      - oid: FOUNDRY-SN-AGENT-MIB::snAgGblCpuUtil5SecAvg
        value: FOUNDRY-SN-AGENT-MIB::snAgGblCpuUtil5SecAvg
        num_oid: '.1.3.6.1.4.1.1991.1.1.2.11.2.0'
        descr: 'CPU 5sec avg'
        index: 1
      # CPU utilization - 1 minute average
      - oid: FOUNDRY-SN-AGENT-MIB::snAgGblCpuUtil1MinAvg
        value: FOUNDRY-SN-AGENT-MIB::snAgGblCpuUtil1MinAvg
        num_oid: '.1.3.6.1.4.1.1991.1.1.2.11.3.0'
        descr: 'CPU 1min avg'
        index: 2
  sensors:
    temperature:
      data:
        # Module Temperatures - Base sensor table
        - oid: snAgentTempTable
          value: snAgentTempValue
          divisor: 2
          num_oid: '.1.3.6.1.4.1.1991.1.1.2.13.1.1.4.{{ $index }}'
          descr: snAgentTempSensorDescr
          index: '{{ $index }}'
          group: 'Module Temperatures'
        # Module Temperatures - Extended sensor table (per-unit)
        - oid: snAgentTemp2Table
          value: snAgentTemp2Value
          divisor: 2
          num_oid: '.1.3.6.1.4.1.1991.1.1.2.13.3.1.5.{{ $index }}'
          descr: 'Unit {{ $subindex0 }}/{{ $subindex1 }} Sensor'
          index: '{{ $index }}'
          group: 'Module Temperatures'
    state:
      data:
        # Power Supply Status - Table 1 (standard/standalone)
        # Returns: 1=other, 2=normal, 3=failure
        - oid: snChasPwrSupplyTable
          value: snChasPwrSupplyOperStatus
          num_oid: '.1.3.6.1.4.1.1991.1.1.1.2.1.1.3.{{ $index }}'
          descr: 'Power Supply {{ $index }}'
          index: '{{ $index }}'
          group: 'Power Supply Status'
          state_name: snChasPwrSupplyOperStatus
          states:
            - {value: 1, descr: other, graph: 0, generic: 3}
            - {value: 2, descr: normal, graph: 1, generic: 0}
            - {value: 3, descr: failure, graph: 0, generic: 2}
        # Power Supply Status - Table 2 (stacked configurations)
        # Index format: {unit}.{ps_number} (e.g., 1.1, 1.2, 2.1, 2.2)
        # Returns: 1=other, 2=normal, 3=failure
        - oid: FOUNDRY-SN-AGENT-MIB::snChasPwrSupply2Table
          value: FOUNDRY-SN-AGENT-MIB::snChasPwrSupply2OperStatus
          num_oid: '.1.3.6.1.4.1.1991.1.1.1.2.2.1.4.{{ $index }}'
          descr: 'Unit {{ $subindex0 }} Power Supply {{ $subindex1 }}'
          index: '{{ $index }}'
          group: 'Power Supply Status'
          state_name: snChasPwrSupply2OperStatus
          skip_values:
            - oid: "SNMPv2-MIB::sysDescr.0"
              op: "!~"
              value: "Stacking System"
          states:
            - {value: 1, descr: other, graph: 0, generic: 3}
            - {value: 2, descr: normal, graph: 1, generic: 0}
            - {value: 3, descr: failure, graph: 0, generic: 2}
        # Fan Status
        # Returns: 1=other, 2=normal, 3=failure
        - oid: snChasFanTable
          value: snChasFanOperStatus
          num_oid: '.1.3.6.1.4.1.1991.1.1.1.3.1.1.3.{{ $index }}'
          descr: 'Fan {{ $index }}'
          index: 'snChasFanOperStatus.{{ $index }}'
          group: 'Fan Status'
          state_name: snChasFanOperStatus
          states:
            - {value: 1, descr: other, graph: 0, generic: 3}
            - {value: 2, descr: normal, graph: 1, generic: 0}
            - {value: 3, descr: failure, graph: 0, generic: 2}

        # Stack Configuration State - DISABLED
        # This OID does NOT exist on firmware 08.0.30u
        # Commented out to prevent discovery errors
        # - oid: FOUNDRY-SN-SWITCH-GROUP-MIB::snStackingGlobalConfigState
        #   value: FOUNDRY-SN-SWITCH-GROUP-MIB::snStackingGlobalConfigState
        #   num_oid: '.1.3.6.1.4.1.1991.1.1.3.31.2.1.1.0'
        #   descr: 'Stack Configuration'
        #   group: 'Stack Status'
        #   state_name: snStackingGlobalConfigState
        #   states:
        #     - { value: 0, descr: disabled, graph: 0, generic: 3 }
        #     - { value: 1, descr: enabled, graph: 1, generic: 0 }
        #     - { value: 2, descr: unsupported, graph: 0, generic: 2 }

        # Stack Unit State - Verified working on 6-unit stack
        # Returns: 1=local (master), 2=remote (members)
        - oid: FOUNDRY-SN-STACKING-MIB::snStackingOperUnitTable
          value: FOUNDRY-SN-STACKING-MIB::snStackingOperUnitState
          num_oid: '.1.3.6.1.4.1.1991.1.1.3.31.2.2.1.5.{{ $index }}'
          descr: 'Unit {{ $index }} State'
          group: 'Stack Status'
          state_name: snStackingOperUnitState
          skip_values:
            - oid: "SNMPv2-MIB::sysDescr.0"
              op: "!~"
              value: "Stacking System"
          states:
            - {value: 1, descr: local, graph: 1, generic: 0}
            - {value: 2, descr: remote, graph: 1, generic: 0}
            - {value: 3, descr: reserved, graph: 0, generic: 2}
            - {value: 4, descr: empty, graph: 0, generic: 2}

        # Stack Unit Role - Verified working on 6-unit stack
        # Returns: 2=active (master), 3=standby, 4=member
        - oid: FOUNDRY-SN-STACKING-MIB::snStackingOperUnitTable
          value: FOUNDRY-SN-STACKING-MIB::snStackingOperUnitRole
          num_oid: '.1.3.6.1.4.1.1991.1.1.3.31.2.2.1.2.{{ $index }}'
          descr: 'Unit {{ $index }} Role'
          group: 'Stack Status'
          state_name: snStackingOperUnitRole
          skip_values:
            - oid: "SNMPv2-MIB::sysDescr.0"
              op: "!~"
              value: "Stacking System"
          states:
            - {value: 1, descr: other, graph: 0, generic: 3}
            - {value: 2, descr: active, graph: 1, generic: 0}
            - {value: 3, descr: standby, graph: 1, generic: 0}
            - {value: 4, descr: member, graph: 1, generic: 0}
            - {value: 5, descr: standalone, graph: 1, generic: 0}
