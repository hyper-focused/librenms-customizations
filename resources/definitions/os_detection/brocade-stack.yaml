# Brocade Stack OS Detection
# Single unified module: FastIron (FCX, FWS, FLS, etc.) + ICX stackable switches
# FastIron: FCX, FWS, FLS — IronWare/FastIron OS, enterprise 1991
# ICX: 6430/6450/6610/6650/7150/7250/7450/7650/7750 — FastIron OS, enterprise 1991 (OID-based detection)
# Optional future: TurboIron if synergies exist (else in routing/modular project)

os: brocade-stack
text: 'FastIron / ICX Stackable Switches'
type: network
icon: brocade
group: brocade
over:
    - { graph: device_bits, text: 'Device Traffic' }
    - { graph: device_processor, text: 'CPU Usage' }
    - { graph: device_mempool, text: 'Memory Usage' }
mib_dir: brocade
discovery:
    -
        # Brocade/Ruckus Stackable Switches - All stacking-enabled devices
        # Shared sysObjectID for all stackable FastIron and ICX switches
        sysDescr:
            - 'Stacking System'  # Primary indicator of stacking capability
        sysObjectID:
            - .1.3.6.1.4.1.1991.1.3.48  # Foundry/Brocade stackable OID
    -
        # ICX Switch Families - OID-based detection
        # All ICX families use specific Foundry enterprise OIDs
        sysObjectID:
            - .1.3.6.1.4.1.1991.1.3.56  # ICX6610 family
            - .1.3.6.1.4.1.1991.1.3.57  # ICX6430 family
            - .1.3.6.1.4.1.1991.1.3.58  # ICX6450 family
            - .1.3.6.1.4.1.1991.1.3.59  # ICX6650 family
            - .1.3.6.1.4.1.1991.1.3.60  # ICX7750 family
            - .1.3.6.1.4.1.1991.1.3.61  # ICX7450 family
            - .1.3.6.1.4.1.1991.1.3.62  # ICX7250 family
            - .1.3.6.1.4.1.1991.1.3.64  # ICX7150 family
            - .1.3.6.1.4.1.1991.1.3.65  # ICX7650 family
    -
        # FastIron Stackable Switches (standalone mode detection)
        # These switches can stack but may be detected as standalone
        # OID-based detection for FCX, FWS, FLS families
        sysObjectID:
            - .1.3.6.1.4.1.1991.1.3.45  # FGS/FWS Family OID
            - .1.3.6.1.4.1.1991.1.3.46  # FLS Family OID
            - .1.3.6.1.4.1.1991.1.3.48  # Stackable OID (when stacking enabled)
            - .1.3.6.1.4.1.1991.1.3.54  # FCX Family standalone OID
    -
        # Generic FastIron/IronWare fallback
        # Catches any remaining FastIron devices not covered above
        sysDescr:
            - 'FastIron'
            - 'IronWare'
        sysObjectID:
            - .1.3.6.1.4.1.1991.1.3  # Generic Foundry FastIron

# Minimal skip conditions - only exclude obvious non-stackable routing devices
skip_values:
    -
        # Skip NetIron routing switches (clearly routing-focused)
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'NetIron'
    -
        # Skip BigIron chassis routing switches (enterprise routing)
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'BigIron'
    -
        # Skip TurboIron routing switches (core routing)
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'TurboIron'
    -
        # Skip ServerIron load balancers (application delivery)
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'ServerIron'
    #  - Brocade enterprise not needed - fabric switch OID's only
        # Brocade enterprise (ICX, newer firmware)
        # sysDescr:
        #     - FastIron
        # sysObjectID:
        #     - .1.3.6.1.4.1.1588.2.1.1.1.3

oids:
    no_bulk:
        - ifPhysAddress

register_mibs:
    - FOUNDRY-SN-ROOT-MIB
    - FOUNDRY-SN-AGENT-MIB
    - FOUNDRY-SN-SWITCH-GROUP-MIB
    - FOUNDRY-SN-STACKING-MIB
