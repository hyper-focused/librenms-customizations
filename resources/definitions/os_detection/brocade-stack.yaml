# Brocade Stack OS Detection
# Single unified module: FastIron (FCX, FWS, FLS, etc.) + ICX stackable switches
# FastIron: FCX, FWS, FLS — IronWare/FastIron OS, enterprise 1991
# ICX: 6430/6450/6610/6650/7150/7250/7450/7650/7750 — FastIron OS, enterprise 1991/1588
# Optional future: TurboIron if synergies exist (else in routing/modular project)

os: brocade-stack
text: 'FastIron / ICX Stack'
type: network
icon: brocade
group: brocade
over:
    - { graph: device_bits, text: 'Device Traffic' }
    - { graph: device_processor, text: 'CPU Usage' }
    - { graph: device_mempool, text: 'Memory Usage' }
mib_dir: brocade
discovery:
    -
        # Primary: Stacking System in sysDescr (FastIron + ICX)
        # Matches: "Stacking System FCX648...", "Stacking System ICX6450-48...", FWS, FLS, etc.
        sysDescr:
            - Stacking System
        sysObjectID:
            - .1.3.6.1.4.1.1991.1.3.48  # Foundry stackable (FCX/ICX/FWS/FLS under 1991)
    -
        # FastIron/IronWare without "Stacking System" (e.g. standalone FWS/FLS/FCX)
        sysDescr:
            - FastIron
        sysObjectID:
            - .1.3.6.1.4.1.1991.1.3

# Skip conditions - prevent incorrect detection of routing switches
skip_values:
    -
        # Skip NetIron routing switches
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'NetIron'
    -
        # Skip MLX series routing switches
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'MLX'
    -
        # Skip XMR series routing switches
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'XMR'
    -
        # Skip BigIron chassis routing switches
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'BigIron'
    -
        # Skip TurboIron routing switches
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'TurboIron'
    -
        # Skip CES carrier ethernet switches
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'CES'
    -
        # Skip CER series (carrier ethernet routers)
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'CER'
    -
        # Skip ServerIron (server load balancing switches)
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'ServerIron'
    -
        # Skip FESX series (older FastIron Edge switches - use foundryos)
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'FESX'
    -
        # Skip FWSX series (older FastIron Workgroup switches - use foundryos)
        oid: SNMPv2-MIB::sysDescr.0
        op: '~'
        value: 'FWSX'
    #  - Brocade enterprise not needed - fabric switch OID's only
        # Brocade enterprise (ICX, newer firmware)
        # sysDescr:
        #     - FastIron
        # sysObjectID:
        #     - .1.3.6.1.4.1.1588.2.1.1.1.3

oids:
    no_bulk:
        - ifPhysAddress

register_mibs:
    - FOUNDRY-SN-ROOT-MIB
    - FOUNDRY-SN-AGENT-MIB
    - FOUNDRY-SN-SWITCH-GROUP-MIB
    - FOUNDRY-SN-STACKING-MIB
